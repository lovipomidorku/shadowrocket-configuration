# made by lovipomidorku
[General]

# Системные сетевые вызовы (например, push-уведомления, iOS системные сервисы) будут обходить прокси.
# Если выставить false, легитимный системный трафик может пойти через прокси,
# что приведёт к задержкам или некорректной работе системных функций.
bypass-system = true

# Адреса/домены, обходящие прокси, но проходящие через туннель (TUN-интерфейс)
skip-proxy = 192.168.0.0/16,10.0.0.0/8,172.16.0.0/12,localhost,*.local,captive.apple.com

# IP-диапазоны, исключённые из туннеля (TUN-интерфейс). Например, UDP/DNS для стабильности сетевых сервисов
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32, 239.255.255.250/32

# Перезаписывает системный DNS на указанные DoH-серверы. Google DNS — стандартный, Adguard предлагает блокировку рекламы. Хорошая практика для приватности и обхода фильтров.
# dns-server = system
# Вы можете выбрать альтернативный DOH/DOT — https://github.com/curl/curl/wiki/DNS-over-HTTPS
dns-server = https://dns.google/dns-query, https://dns.adguard-dns.com/dns-query

# При сбое основного django Server — fallback на системный DNS. Можно указать другие DoH, но у вас стоит system для совместимости
fallback-dns-server = system

# Если DNS-запросы через основной DNS (например DoH) неудачны, будет ли пробоваться системный DNS. При false — отказ DNS через fallback. Можно включить, чтобы повысить стабильность разрешения.
dns-fallback-system = true

# Если прямое разрешение DNS не работает, использовать прокси-сервер для DNS-запросов
dns-direct-fallback-proxy = true

# Перехватывает DNS-запросы некоторых сервисов (Например, Netflix) на UDP/TCP порт 53 и направляет через программу
hijack-dns = :53

# Отключение поддержки IPv6. В системах и сетях, где IPv6 стабильный и
# поддерживается, можно включить (true), иначе IPv4 останется основным
ipv6 = false

# Отдавать приоритет разрешению DNS-записей AAAA (IPv6) над A (IPv4).
# Важно только если ipv6 включён. Полезно на сетях с сильной поддержкой IPv6, иначе оставлять false.
prefer-ipv6 = false

# Управляет тем, будет ли DNS разрешение происходить напрямую через системный DNS, а не через прокси или настроенный DoH/DoT. Если точно нужен перехват DNS — оставлять false; для обхода по системному DNS — true.
dns-direct-system = false

# Включает автоматический ответ на ping (ICMP Echo Request) от имени TUN-интерфейса. Удобно для сетевой диагностики, но может приводить к созданию fake-IP маппинга, что увеличивает расход ресурсов и может в итоге разряжать аккумулятор. Если цель — минимизация fake-IP и энергозатрат, ставить false.
icmp-auto-reply = false

# Управляет, активна ли политика REJECT для URL-перезаписи вне режима конфигурации. При true REJECT работает постоянно, что может «жёстко» блокировать трафик.
always-reject-url-rewrite = false

# Если true, при DNS-запросах возвращаются приватные IP адреса (например, из диапазона 192.168.x.x). При false Shadowrocket будет считать домен "захваченным" и принудительно отправит трафик через прокси, что может нарушать локальную сеть. Обычно лучше оставлять true.
private-ip-answer = true

# Как поступать с UDP-трафиком, если политика узла не поддерживает UDP-перенаправление: отбрасывать (REJECT) или направлять напрямую (DIRECT). Выбор зависит от желаемого поведения и возможности узла.
udp-policy-not-supported-behaviour = REJECT

# Позволяет SR возвращать настоящий IP вместо fake-IP для перечисленных доменов. Это важно для служб, где нужно "реальное" соединение без проксирования (например, NTP, Cloudflare client). Позволяет сократить проблемы с задержками, ошибками соединения и энергопотреблением.
always-real-ip = *

# По умолчанию TUN пытается взять на себя весь трафик,
# но из-за системных особенностей часть трафика может обходить туннель.
# С помощью этого параметра можно добавить дополнительные IP-диапазоны или маршруты,
# которые гарантированно будут проходить через туннель Shadowrocket.
# Обычно оставляют пустым, если нет проблем с прохождением трафика.
# tun-included-routes =

# Внешние конфигурационные файлы.
# include = sr_ru_extended.conf



# Включение HTTPS-декрипции:
# В Config → ⓘ, → HTTPS Decryption → Certificate → Generate A New CA Certificate → Install CA Certificate to System
# В настройках системы — скачанные профили — «Установить».
# В настройках системы — «Основные» — «О устройстве» — «Настройки доверия сертификатов» — включить сертификат Shadowrocket.
# Для синхронизации между устройствами, если конфиг содержит ключ, рекомендуется сразу установить сертификат, а не генерировать новый.

# Опционально. Добавьте эти адреса в настройках программы Settings → GeoLite2 Database
# Если у вас нет аккаунта на Maxmind и вы испольузуете финальное правило Proxy или Auto
# country: https://git.io/GeoLite2-Country.mmdb
# asn: https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-ASN.mmdb



# URL-адрес обновления файла конфигурации
update-url = https://raw.githubusercontent.com/lovipomidorku/shadowrocket-configuration/refs/heads/main/Bypass_Russia.conf

# Выбираем наиболее быстрый сервера для прокси
# [Proxy Group]
# AUTO = url-test,interval=600,timeout=5,url=https://cp.cloudflare.com/generate_204,policy-regex-filter=*



# Выборочные правила маршрутизации

[Rule]
######################################
#############   PROXY    #############
######################################
RULE-SET,https://raw.githubusercontent.com/misha-tgshv/shadowrocket-configuration-file/main/rules/voice_ports.list,PROXY
RULE-SET,https://raw.githubusercontent.com/lovipomidorku/shadowrocket-configuration/refs/heads/main/ru_blocked.list,PROXY

# Telegram
DOMAIN-SUFFIX,t.me,PROXY
DOMAIN-SUFFIX,tdesktop.com,PROXY
DOMAIN-SUFFIX,telegra.ph,PROXY
DOMAIN-SUFFIX,telegram.me,PROXY
DOMAIN-SUFFIX,telegram.org,PROXY
DOMAIN-SUFFIX,telesco.pe,PROXY
IP-CIDR,91.108.4.0/22,PROXY,no-resolve
IP-CIDR,91.108.8.0/22,PROXY,no-resolve
IP-CIDR,91.108.12.0/22,PROXY,no-resolve
IP-CIDR,91.108.16.0/22,PROXY,no-resolve
IP-CIDR,91.108.56.0/22,PROXY,no-resolve
IP-CIDR,109.239.140.0/24,PROXY,no-resolve
IP-CIDR,149.154.160.0/20,PROXY,no-resolve
IP-CIDR,2001:B28:F23D::/48,PROXY,no-resolve
IP-CIDR,2001:B28:F23F::/48,PROXY,no-resolve
IP-CIDR,2001:67C:4E8::/48,PROXY,no-resolve

# WhatsApp
DOMAIN-SUFFIX,whatsapp.net,PROXY
DOMAIN-SUFFIX,whatsapp.com,PROXY

# ChatGPT
DOMAIN,api.statsig.com,PROXY
DOMAIN,browser-intake-datadoghq.com,PROXY
DOMAIN,chat.openai.com.cdn.cloudflare.net,PROXY
DOMAIN,o33249.ingest.sentry.io,PROXY
DOMAIN,openai-api.arkoselabs.com,PROXY
DOMAIN,openaicom-api-bdcpf8c6d2e9atf6.z01.azurefd.net,PROXY
DOMAIN,openaicomproductionae4b.blob.core.windows.net,PROXY
DOMAIN,production-openaicom-storage.azureedge.net,PROXY
DOMAIN,static.cloudflareinsights.com,PROXY
DOMAIN-KEYWORD,openaicom-api,PROXY
DOMAIN-SUFFIX,algolia.net,PROXY
DOMAIN-SUFFIX,auth0.com,PROXY
DOMAIN-SUFFIX,cdn.cloudflare.net,PROXY
DOMAIN-SUFFIX,challenges.cloudflare.com,PROXY
DOMAIN-SUFFIX,chatgpt.livekit.cloud,PROXY
DOMAIN-SUFFIX,client-api.arkoselabs.com,PROXY
DOMAIN-SUFFIX,events.statsigapi.net,PROXY
DOMAIN-SUFFIX,featuregates.org,PROXY
DOMAIN-SUFFIX,host.livekit.cloud,PROXY
DOMAIN-SUFFIX,identrust.com,PROXY
DOMAIN-SUFFIX,intercom.io,PROXY
DOMAIN-SUFFIX,intercomcdn.com,PROXY
DOMAIN-SUFFIX,launchdarkly.com,PROXY
DOMAIN-SUFFIX,oaistatic.com,PROXY
DOMAIN-SUFFIX,oaiusercontent.com,PROXY
DOMAIN-SUFFIX,observeit.net,PROXY
DOMAIN-SUFFIX,openai.com,PROXY
DOMAIN-SUFFIX,openaiapi-site.azureedge.net,PROXY
DOMAIN-SUFFIX,openaicom.imgix.net,PROXY
DOMAIN-SUFFIX,poe.com,PROXY
DOMAIN-SUFFIX,segment.io,PROXY
DOMAIN-SUFFIX,sentry.io,PROXY
DOMAIN-SUFFIX,stripe.com,PROXY
DOMAIN-SUFFIX,turn.livekit.cloud,PROXY
IP-CIDR,24.199.123.28/32,PROXY,no-resolve
IP-CIDR,45.76.214.191/32,PROXY,no-resolve
IP-CIDR,64.23.132.171/32,PROXY,no-resolve
IP-CIDR,143.198.200.27/32,PROXY,no-resolve
IP-CIDR,159.89.204.203/32,PROXY,no-resolve

# DNS Leak
DOMAIN-SUFFIX,dnsleaktest.com,PROXY
DOMAIN-SUFFIX,dnsleak.com,PROXY
DOMAIN-SUFFIX,expressvpn.com,PROXY
DOMAIN-SUFFIX,nordvpn.com,PROXY
DOMAIN-SUFFIX,surfshark.com,PROXY
DOMAIN-SUFFIX,ipleak.net,PROXY
DOMAIN-SUFFIX,perfect-privacy.com,PROXY
DOMAIN-SUFFIX,browserleaks.com,PROXY
DOMAIN-SUFFIX,browserleaks.org,PROXY
DOMAIN-SUFFIX,vpnunlimited.com,PROXY
DOMAIN-SUFFIX,whoer.net,PROXY
DOMAIN-SUFFIX,whrq.net,PROXY

######################################
#############   DIRECT   #############
######################################
# Russia
GEOIP,RU,DIRECT
DOMAIN-KEYWORD,.ru,DIRECT
DOMAIN-KEYWORD,.su,DIRECT
DOMAIN-KEYWORD,.moscow,DIRECT
DOMAIN-KEYWORD,.xn--80adxhks,DIRECT #.москва
DOMAIN-KEYWORD,.xn--80asehdb,DIRECT #.онлайн
DOMAIN-KEYWORD,..xn--d1acj3b,DIRECT #.дети
DOMAIN-KEYWORD,.xn--80aswg,DIRECT #.сайт
DOMAIN-KEYWORD,.xn--p1acf,DIRECT #.рус
DOMAIN-KEYWORD,.xn--c1avg,DIRECT #.орг
DOMAIN-KEYWORD,.xn--p1ag,DIRECT #.ру
DOMAIN-KEYWORD,.xn--p1ai,DIRECT #.рф

# Apple
DOMAIN,www-cdn.icloud.com.akadns.net,DIRECT
DOMAIN-SUFFIX,aaplimg.com,DIRECT
DOMAIN-SUFFIX,apple-cloudkit.com,DIRECT
DOMAIN-SUFFIX,apple.co,DIRECT
DOMAIN-SUFFIX,apple.com,DIRECT
DOMAIN-SUFFIX,apple.news,DIRECT
DOMAIN-SUFFIX,appstore.com,DIRECT
DOMAIN-SUFFIX,cdn-apple.com,DIRECT
DOMAIN-SUFFIX,crashlytics.com,DIRECT
DOMAIN-SUFFIX,icloud-content.com,DIRECT
DOMAIN-SUFFIX,icloud.com,DIRECT
DOMAIN-SUFFIX,icloud.com.cn,DIRECT
DOMAIN-SUFFIX,me.com,DIRECT
DOMAIN-SUFFIX,mzstatic.com,DIRECT
DOMAIN-SUFFIX,v2ex.com,DIRECT

# GitHub
DOMAIN-SUFFIX,github.com,DIRECT
DOMAIN-SUFFIX,github.io,DIRECT
DOMAIN-SUFFIX,githubusercontent.com,DIRECT

# DIRECT SITEST (source:https://raw.githubusercontent.com/itdoginfo/allow-domains/main/Russia/outside-raw.lst)
DOMAIN-SUFFIX,1018213540.rsc.cdn77.org,DIRECT
DOMAIN-SUFFIX,avtodor-tr.ru,DIRECT
DOMAIN-SUFFIX,b2c-ticket-sentry.onelya.ru,DIRECT
DOMAIN-SUFFIX,bitrix.info,DIRECT
DOMAIN-SUFFIX,bkvet.ru,DIRECT
DOMAIN-SUFFIX,cdn1.ozonusercontent.com,DIRECT
DOMAIN-SUFFIX,cms1.dzvr.ru,DIRECT
DOMAIN-SUFFIX,counter.yadro.ru,DIRECT
DOMAIN-SUFFIX,dzvr.ru,DIRECT
DOMAIN-SUFFIX,fairplay-proxy.ott.yandex.ru,DIRECT
DOMAIN-SUFFIX,fssp.gov.ru,DIRECT
DOMAIN-SUFFIX,gov.ru,DIRECT
DOMAIN-SUFFIX,graphql.kinopoisk.ru,DIRECT
DOMAIN-SUFFIX,lemanapro.ru,DIRECT
DOMAIN-SUFFIX,leroymerlin.ru,DIRECT
DOMAIN-SUFFIX,mobileapp.russianpost.ru,DIRECT
DOMAIN-SUFFIX,mos.ru,DIRECT
DOMAIN-SUFFIX,mosenergosbyt.ru,DIRECT
DOMAIN-SUFFIX,ozon.ru,DIRECT
DOMAIN-SUFFIX,pesc.ru,DIRECT
DOMAIN-SUFFIX,pochta.ru,DIRECT
DOMAIN-SUFFIX,rosreestr.gov.ru,DIRECT
DOMAIN-SUFFIX,rzd-bonus.ru,DIRECT
DOMAIN-SUFFIX,rzd.ru,DIRECT
DOMAIN-SUFFIX,showip.net,DIRECT
DOMAIN-SUFFIX,sys.refocus.ru,DIRECT
DOMAIN-SUFFIX,vshark.ttk.ru,DIRECT
DOMAIN-SUFFIX,widevine-proxy.ott.yandex.ru,DIRECT
DOMAIN-SUFFIX,xn--90aijkdmaud0d.xn--p1ai,DIRECT
DOMAIN-SUFFIX,yandex.net,DIRECT

###################################
#############   LAN   #############
###################################
IP-CIDR,192.168.0.0/16,DIRECT
IP-CIDR,10.0.0.0/8,DIRECT
IP-CIDR,172.16.0.0/12,DIRECT
IP-CIDR,127.0.0.0/8,DIRECT

# Final
FINAL,PROXY





